-- lab_4_demo.sql
-- Демонстрація роботи представлення, процедури та тригера
-- для бази petaccessories

-------------------------------------------------------
-- 1. Перевірка представлення v_Detailed_Orders
-------------------------------------------------------

SELECT * FROM `v_Detailed_Orders`;


-------------------------------------------------------
-- 2. Перевірка процедури sp_AddNewAccessory
-------------------------------------------------------

-- Додаємо новий аксесуар (лежанка для кота)
CALL sp_AddNewAccessory(
    'Лежанка "Котяче щастя"',          -- p_nazva
    'М’яка лежанка ручної роботи',     -- p_opys
    799.00,                            -- p_cena
    15,                                -- p_kilkist_na_skladi
    'сірий',                           -- p_kolir
    'M',                               -- p_rozmir
    1,                                 -- p_ruchna_robota (1 = так)
    2                                  -- p_id_kategorii (наприклад, 2 = "Лежанки")
);

-- Перевіряємо, що товар з’явився в таблиці tovar
SELECT *
FROM `tovar`
WHERE `nazva` = 'Лежанка "Котяче щастя"';


-------------------------------------------------------
-- 3. Перевірка тригера trg_Tovar_BeforeUpdate
-------------------------------------------------------

-- Дивимось стан будь-якого товару ДО оновлення (наприклад, id_tovara = 1)
SELECT `id_tovara`, `nazva`, `cena`, `updated_at`
FROM `tovar`
WHERE `id_tovara` = 1;

-- Оновлюємо ціну товару – цим ми "розбуджуємо" тригер
UPDATE `tovar`
SET `cena` = 399.00
WHERE `id_tovara` = 1;

-- Дивимось стан товару ПІСЛЯ оновлення
SELECT `id_tovara`, `nazva`, `cena`, `updated_at`
FROM `tovar`
WHERE `id_tovara` = 1;
